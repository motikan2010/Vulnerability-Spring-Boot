#!/bin/bash
set -ex

CODEQL_DB_NAME="codeql_db"

function moveWorkDir {
  cd codeql_work/codeql_cli/
}

function createCodeqlDatabase {
  rm -rf ${CODEQL_DB_NAME}
  ./codeql database create -l=java -s ../.. ${CODEQL_DB_NAME}
}

function runAnalyze() {
  filename=$(date +%Y%m%d-%H%M)_$1_result.sarif
  ./codeql database analyze "${CODEQL_DB_NAME}" \
    ../codeql/java/ql/src/Security/CWE/$1/ \
    --format=sarif-latest --sarif-multicause-markdown --output=${filename} --no-sarif-add-snippets
  mv ${filename} ../results/
}

moveWorkDir

createCodeqlDatabase

runAnalyze $1
